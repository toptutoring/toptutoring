<div class="row">
  <div class="col-md-12">
    <div class="widget">
      <div class="widget-heading clearfix">
        <h3 class="widget-title pull-left">Students</h3>
      </div>
      <div class="widget-body">
        <div class="table-responsive">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Client</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Subject</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% @student_tutor_engagements.each do |engagement| %>
                <tr>
                  <% client = User.find(engagement.client_id) %>
                  <td><%= engagement.student_name %></td>
                  <td><%= client.name %></td>
                  <% if !engagement.student_id.nil? %>
                    <% student = User.find(engagement.student_id) %>
                    <td><%= student.email %></td>
                    <td><%= student.phone_number %></td>
                    <td><%= student.student_info.subject %></td>
                    <% if can_send_email?(client) %>
                      <td>
                        <%= link_to "Send Email", new_email_path(student), class: "btn btn-outline btn-primary" %>
                      </td>
                    <% end %>
                  <% else %>
                    <td><%= client.email %></td>
                    <td><%= client.phone_number %></td>
                    <td><%= client.client_info.subject %></td>
                      <% if can_send_email?(client) %>
                        <td>
                          <%= link_to "Send Email", new_email_path(client), class: "btn btn-outline btn-primary" %>
                        </td>
                      <% end %>
                  <% end %>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
