<!-- Styles for this form is defined in "stripe.scss" -->

<%= form_tag clients_payments_path, id: "new_payment" do %>
  <!--  Credit Card Inputs -->
  <%= content_tag :div, nil, id: "stripe_publishable_key", data: { key: ENV['STRIPE_PUBLISHABLE_KEY'] } %>
  <div class="col-lg-6">
    <div class="widget">
      <div class="widget-heading">
        <h3 class="widget-title">Purchase Hours</h3>
      </div>
      <div class="widget-body">
        <div class="widget-content">
          <% if @academic_types.count > 1 %>
            <div class="row">
              <div class="col-sm-12">
                <%= label :academic_type, "What hours would you like to purchase?" %>
              </div>
              <div class="col-sm-12">
                <%= select_tag :academic_type, options_for_select(@academic_types.map { |type| [type.humanize, type] }), class: "form-control input-lg", required: true %>
              </div>
            </div>
          <% elsif @academic_types.include?("academic") %>
            <%= label :academic_type, "Purchasing Academic Hours" %>
            <%= hidden_field_tag :academic_type, "academic" %>
          <% else %>
            <%= label :academic_type, "Purchasing Test Prep Hours" %>
            <%= hidden_field_tag :academic_type, "test_prep" %>
          <% end %>

          <div class="row">
            <div class="col-xs-6 text-right">
              <h4 class="fw-300 mb-20">Your Rate</h4>
            </div>
            <div class="col-xs-6">
              <%= content_tag :h4, nil, class: "fw-300",
                data: { academic: current_user.academic_rate.to_s, test: current_user.test_prep_rate.to_s },
                id: "hourly-rate-display" %>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-6 text-right">
              <h4 class="mb-20">
              <%= label_tag :hours_desired, "Hours x", class: "fw-300 m-0" %>
              </h4>
            </div>
            <div class="col-xs-6">
              <%= number_field_tag :hours_desired, 1, min: 1, step: "0.25", class: "form-control input-lg" %>
            </div>
          </div>

          <hr/>

          <div class="row">
            <div class="col-xs-6 text-right">
              <h4 class="mb-20 fw-300">Your Total</h4>
            </div>
            <div id="payment-total" class="col-xs-6">
              <h4 id="payment-total-display" class="mb-20 fw-400">$0.00</h4>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-6 text-right">
              <h4 id="hour-type" class="mb-20 fw-300">Academic Hours</h4>
            </div>

            <div class="col-xs-2">
              <%= content_tag :h4, nil, class: "mb-20 fw-300 text-left",
                data: { academic: current_user.academic_credit, test: current_user.test_prep_credit },
                id: "current-hours" %>
          </div>

          <div class="col-xs-1">
            <h4 class="mb-20 fw-300 text-center">â†’</h4>
          </div>

          <div class="col-xs-2">
            <h4 id="after-purchase-hours" class="mb-20 fw-300 text-right"></h4>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="widget">
      <div class="widget-body">
        <div class="widget-content">
          <%= label :credit_card, "Credit Card Information" %>
          <div>
            <%= text_field_tag :name, nil, placeholder: "Cardholder name", class: "form-control input-lg", required: true %>
          </div>
          <div id="card-element" class="form-control input-lg mt-20"></div>
          <h4 id="card-error" class="fw-300 text-right"></h4>

          <div class="row m-0">
              <!-- button disabling is handled by jaavascript because Stripe validation requires javascript -->
              <%= submit_tag "Purchase Hours", class: "pull-right btn btn-primary", data: { disable_with: false } %>
          </div>
        </div>
      </div>
    </div>
  </div>

<% end %>
<%= javascript_include_tag STRIPE_JS_HOST %>
